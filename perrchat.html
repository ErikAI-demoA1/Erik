<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8">
  <title>ErikAI Peer Chat - Spojenie kÃ³dom</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; background: #f4f4f4; }
    textarea, input[type=text] { width: 100%; margin-bottom: 10px; padding: 10px; }
    button { width: 100%; padding: 10px; background: #007bff; color: white; border: none; margin-bottom: 10px; }
    .log { height: 150px; background: #fff; overflow-y: auto; border: 1px solid #ccc; padding: 0.5rem; }
    .status { font-weight: bold; color: green; margin-bottom: 10px; }
  </style>
</head>
<body>
  <h2>ğŸ’¬ ErikAI Peer Chat (cez kÃ³d)</h2>

  <button onclick="vytvorKod()">ğŸ” Vytvor kÃ³d (mobil 1)</button>
  <textarea id="vygenerovanyKod" placeholder="Tu sa zobrazÃ­ tvoj kÃ³d..."></textarea>

  <input type="text" id="prijatyKod" placeholder="Sem vloÅ¾ kÃ³d od kamoÅ¡a...">
  <button onclick="pripojKod()">ğŸ”“ Pripoj sa (mobil 2)</button>

  <div class="status" id="stavSpojenia">âŒ ZatiaÄ¾ nie ste spojenÃ­</div>

  <input type="text" id="sprava" placeholder="NapÃ­Å¡ sprÃ¡vu...">
  <button onclick="odosliSpravu()">âœ‰ï¸ PoslaÅ¥</button>
  <div class="log" id="chat"></div>

  <script>
    let pc;
    let dc;
    let spojene = false;

    const konfiguracia = {
      iceServers: [{ urls: 'stun:stun.l.google.com:19302' }]
    };

    async function vytvorKod() {
      pc = new RTCPeerConnection(konfiguracia);
      dc = pc.createDataChannel("chat");
      nastavChat();

      const offer = await pc.createOffer();
      await pc.setLocalDescription(offer);
      document.getElementById("vygenerovanyKod").value = btoa(JSON.stringify(offer));
    }

    async function pripojKod() {
      const kod = document.getElementById("prijatyKod").value;
      const offer = JSON.parse(atob(kod));
      pc = new RTCPeerConnection(konfiguracia);

      pc.ondatachannel = (e) => {
        dc = e.channel;
        nastavChat();
      };

      await pc.setRemoteDescription(offer);
      const answer = await pc.createAnswer();
      await pc.setLocalDescription(answer);

      const kodAnswer = btoa(JSON.stringify(answer));
      prompt("PoÅ¡li tento kÃ³d naspÃ¤Å¥ prvÃ©mu mobilu:", kodAnswer);
    }

    function nastavChat() {
      dc.onopen = () => {
        spojene = true;
        document.getElementById("stavSpojenia").textContent = "âœ… Ste spojenÃ­, mÃ´Å¾ete pÃ­saÅ¥!";
        document.getElementById("stavSpojenia").style.color = "green";
      };
      dc.onmessage = (e) => {
        document.getElementById("chat").innerHTML += `<div><b>ğŸŸ¢ KamoÅ¡:</b> ${e.data}</div>`;
      };
    }

    function odosliSpravu() {
      const text = document.getElementById("sprava").value;
      if (!spojene) {
        alert("Najprv sa musÃ­te spojiÅ¥ cez kÃ³d!");
        return;
      }
      dc.send(text);
      document.getElementById("chat").innerHTML += `<div><b>ğŸ”µ Ty:</b> ${text}</div>`;
      document.getElementById("sprava").value = "";
    }
  </script>
</body>
</html>
