<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8">
  <title>ErikAI Peer Chat (bez servera)</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 1rem;
      background: #f4f4f4;
      max-width: 800px;
      margin: auto;
    }
    textarea, input[type=text] {
      width: 100%;
      padding: 10px;
      margin-bottom: 0.5rem;
      box-sizing: border-box;
    }
    button {
      padding: 10px;
      margin: 5px 0;
      width: 100%;
      background: #007bff;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background: #0056b3;
    }
    .log {
      height: 200px;
      background: white;
      overflow-y: auto;
      border: 1px solid #ccc;
      padding: 0.5rem;
      margin-top: 0.5rem;
    }
    hr {
      margin: 1.5rem 0;
    }
  </style>
</head>
<body>

  <h2>üí¨ ErikAI Peer Chat (bez servera)</h2>

  <!-- OFFER -->
  <button onclick="startConnection()">1Ô∏è‚É£ Spusti spojenie (vytvor OFFER)</button>
  <textarea id="offer" placeholder="Tu sa objav√≠ tvoj OFFER..."></textarea>
  <textarea id="remoteAnswer" placeholder="Sem vlo≈æ ANSWER z druh√©ho mobilu..."></textarea>
  <button onclick="addAnswer()">2Ô∏è‚É£ Vlo≈æi≈• odpoveƒè (ANSWER)</button>

  <hr>

  <!-- ANSWER -->
  <textarea id="answer" placeholder="Ak ti niekto po≈°le OFFER, vlo≈æ sem..."></textarea>
  <button onclick="createAnswer()">3Ô∏è‚É£ Vytvori≈• odpoveƒè (ANSWER)</button>
  <textarea id="sendAnswer" placeholder="Po≈°li tento ANSWER sp√§≈• druh√©mu..."></textarea>

  <hr>

  <!-- CHAT -->
  <input type="text" id="message" placeholder="Nap√≠≈° spr√°vu...">
  <button onclick="sendMessage()">‚úâÔ∏è Posla≈•</button>
  <div class="log" id="chat"></div>

<script>
  let pc;
  let dc;

  function log(msg, incoming = false) {
    const div = document.createElement("div");
    div.innerHTML = incoming ? `<b>üü¢ Prijat√©:</b> ${msg}` : `<b>üîµ Ty:</b> ${msg}`;
    document.getElementById("chat").appendChild(div);
    document.getElementById("chat").scrollTop = document.getElementById("chat").scrollHeight;
  }

  function initConnection() {
    pc = new RTCPeerConnection();
    pc.ondatachannel = (event) => {
      dc = event.channel;
      dc.onmessage = (e) => log(e.data, true);
      dc.onopen = () => log("<i>‚úÖ Spojenie nadviazan√©!</i>");
    };
  }

  async function startConnection() {
    initConnection();
    dc = pc.createDataChannel("chat");
    dc.onmessage = (e) => log(e.data, true);
    dc.onopen = () => log("<i>‚úÖ Spojenie nadviazan√©!</i>");
    const offer = await pc.createOffer();
    await pc.setLocalDescription(offer);
    document.getElementById("offer").value = JSON.stringify(offer);
  }

  async function addAnswer() {
    const answerText = document.getElementById("remoteAnswer").value;
    if (!answerText) return alert("Ch√Ωba ANSWER.");
    const answer = JSON.parse(answerText);
    await pc.setRemoteDescription(answer);
  }

  async function createAnswer() {
    initConnection();
    const offerText = document.getElementById("answer").value;
    if (!offerText) return alert("Ch√Ωba OFFER.");
    const offer = JSON.parse(offerText);
    await pc.setRemoteDescription(offer);
    const answer = await pc.createAnswer();
    await pc.setLocalDescription(answer);
    document.getElementById("sendAnswer").value = JSON.stringify(answer);
  }

  function sendMessage() {
    const msg = document.getElementById("message").value.trim();
    if (!msg || !dc || dc.readyState !== "open") return;
    dc.send(msg);
    log(msg);
    document.getElementById("message").value = "";
  }
</script>

</body>
</html>
