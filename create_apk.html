<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ErikAI - Vytvor si vlastnú PWA appku</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f1f2f6; }
    textarea, input { width: 100%; margin: 10px 0; padding: 10px; font-family: monospace; }
    button { padding: 10px 15px; margin-right: 10px; border: none; border-radius: 5px; font-weight: bold; }
    .preview { margin-top: 20px; padding: 10px; background: white; min-height: 150px; border-radius: 10px; }
    .green { background: #2ed573; color: white; }
    .blue { background: #1e90ff; color: white; }
  </style>
</head>
<body>

<h2>ErikAI - Vytvor si vlastnú PWA appku</h2>

<label>Názov tvojej appky:</label>
<input type="text" id="appName" value="MojaErikAIApp">

<label>HTML kód tvojej aplikácie:</label>
<textarea id="htmlCode" rows="10"><erikai_black>
<title>Moja testovacia appka</title>
<name_red>Vitaj v mojej ErikAI App</name_red>
<text_blue>Toto je moja prvá aplikácia vytvorená cez ErikAI. Funguje ako PWA!</text_blue>
<odkaz>https://mojestranka.sk</odkaz>
<video>https://www.youtube.com/embed/dQw4w9WgXcQ</video></textarea>

<button class="green" onclick="zobrazNahlad()">Zobraziť náhľad</button>
<button class="blue" onclick="stiahnutZip()">Stiahnuť ako PWA (.zip)</button>

<div class="preview" id="previewBox"></div>

<script>
function zobrazNahlad() {
  const html = document.getElementById("htmlCode").value;
  const preview = html
    .replace(/<name_red>(.*?)<\/name_red>/g, '<h2 style="color:red;">$1</h2>')
    .replace(/<text_blue>(.*?)<\/text_blue>/g, '<p style="color:blue;">$1</p>')
    .replace(/<odkaz>(.*?)<\/odkaz>/g, '<a href="$1" target="_blank">$1</a>')
    .replace(/<video>(.*?)<\/video>/g, '<iframe width="100%" height="250" src="$1" frameborder="0" allowfullscreen></iframe>')
    .replace(/<erikai_black>/g, '<div style="background:black; color:white; padding:15px; border-radius:10px;">')
    .replace(/<\/erikai_black>/g, '</div>');
  document.getElementById("previewBox").innerHTML = preview;
}

function stiahnutZip() {
  const name = document.getElementById("appName").value || "MojaErikAIApp";
  const htmlRaw = document.getElementById("htmlCode").value;

  const indexHtml = `<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>${name}</title></head><body>${document.getElementById("previewBox").innerHTML}</body></html>`;

  const manifest = {
    name: name,
    short_name: name,
    start_url: "./index.html",
    display: "standalone",
    background_color: "#ffffff",
    theme_color: "#00a8ff",
    icons: [
      {
        src: "icon.png",
        sizes: "192x192",
        type: "image/png"
      }
    ]
  };

  const serviceWorker = `
    self.addEventListener('fetch', function(event) {
      event.respondWith(fetch(event.request).catch(function() {
        return new Response('Offline');
      }));
    });
  `;

  const zip = new JSZip();
  zip.file("index.html", indexHtml);
  zip.file("manifest.json", JSON.stringify(manifest, null, 2));
  zip.file("service-worker.js", serviceWorker);
  zip.file("icon.png", ""); // Prázdna ikona (možno doplniť)

  zip.generateAsync({ type: "blob" }).then(function(content) {
    const a = document.createElement("a");
    a.href = URL.createObjectURL(content);
    a.download = `${name}_PWA.zip`;
    a.click();
  });
}
</script>
</body>
</html>
